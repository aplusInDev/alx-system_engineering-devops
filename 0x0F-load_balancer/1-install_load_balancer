#!/usr/bin/env bash
# Install HAProxy (use sudo if not running as root)

apt update
apt-get install -y --no-install-recommends software-properties-common
add-apt-repository ppa:vbernat/haproxy-2.9
apt-get install -y haproxy=2.9.\*

# Configure HAProxy
echo "ENABLED=1" >> /etc/default/haproxy

# Create a new configuration file
echo "frontend aplusdev.tech
    bind *:80
    use_backend aplus_servers" >> /etc/haproxy/haproxy.cfg

echo "backend aplus_servers
    balance roundrobin
    server web-01 100.25.20.254:80 check
    server web-02 54.144.154.99:80 check" >> /etc/haproxy/haproxy.cfg

# Test and restart HAProxy
haproxy -f /etc/haproxy/haproxy.cfg -c
service haproxy restart
